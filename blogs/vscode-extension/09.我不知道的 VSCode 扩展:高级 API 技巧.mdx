---
tags:
    [
        å‰ç«¯å¼€å‘,
        VSCode,
        æ‰©å±•å¼€å‘,
        API,
        é«˜çº§æŠ€å·§,
        Workspace API,
        Document API,
        Language Server Protocol,
        Debug API,
        Task API,
        Terminal API,
        Webview API
    ]
category: VSCode
date: 2024-06-05
title: æˆ‘ä¸çŸ¥é“çš„ VSCode æ‰©å±•:é«˜çº§ API æŠ€å·§
desc: æ¢ç´¢ VSCode æ‰©å±•å¼€å‘ä¸­çš„é«˜çº§ API æŠ€å·§ï¼Œæå‡æ‰©å±•çš„åŠŸèƒ½å’Œç”¨æˆ·ä½“éªŒã€‚
slug: vscode-extension-09
---

### å¼•è¨€

ğŸŒŸ åœ¨å‰é¢çš„ç³»åˆ—æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¹ äº† VSCode æ‰©å±•å¼€å‘çš„åŸºç¡€çŸ¥è¯†ã€ç”¨æˆ·ç•Œé¢ã€å¸¸ç”¨ APIã€ç”Ÿå‘½å‘¨æœŸã€è°ƒè¯•ã€å‘å¸ƒå’Œ CI/CDã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢ç´¢ **VSCode æ‰©å±•å¼€å‘ä¸­çš„é«˜çº§ API æŠ€å·§**ï¼Œå­¦ä¹ å¦‚ä½•åˆ©ç”¨æ›´å¼ºå¤§ã€æ›´çµæ´»çš„ API æ¥æ„å»ºæ›´å¤æ‚ã€æ›´æ™ºèƒ½ã€æ›´ç”¨æˆ·å‹å¥½çš„ VSCode æ‰©å±•ã€‚æŒæ¡è¿™äº›é«˜çº§ API æŠ€å·§ï¼Œå°†ä½¿ä½ çš„æ‰©å±•å¼€å‘èƒ½åŠ›æ›´ä¸Šä¸€å±‚æ¥¼ï¼Œè®©ä½ èƒ½å¤Ÿåˆ›é€ å‡ºçœŸæ­£ä»¤äººæƒŠè‰³çš„ VSCode æ‰©å±•ï¼ç°åœ¨ï¼Œå°±è®©æˆ‘ä»¬ä¸€èµ·å¼€å¯ VSCode é«˜çº§ API çš„æ¢ç´¢ä¹‹æ—…ï¼

### é«˜çº§ API æŠ€å·§

ğŸš€ VSCode æä¾›äº†éå¸¸ä¸°å¯Œçš„ APIï¼Œé™¤äº†æˆ‘ä»¬ä¹‹å‰ä»‹ç»çš„å¸¸ç”¨ API å¤–ï¼Œè¿˜æœ‰è®¸å¤šé«˜çº§ API å¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°æ›´å¤æ‚çš„åŠŸèƒ½ã€‚æœ¬èŠ‚å°†ä»‹ç»ä¸€äº›å¸¸ç”¨çš„é«˜çº§ API æŠ€å·§ï¼ŒåŒ…æ‹¬:

#### 1. Workspace API:å¤šå·¥ä½œåŒºæ”¯æŒ

ğŸ“‚ **Workspace API** å…è®¸æ‰©å±•ä¸ VSCode çš„å·¥ä½œåŒºè¿›è¡Œäº¤äº’ï¼ŒåŒ…æ‹¬è·å–å·¥ä½œåŒºä¿¡æ¯ã€ç›‘å¬å·¥ä½œåŒºäº‹ä»¶ã€ç®¡ç†å·¥ä½œåŒºæ–‡ä»¶å¤¹ç­‰ã€‚**å¤šå·¥ä½œåŒº (Multi-root Workspace)** æ˜¯ VSCode çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œå…è®¸ç”¨æˆ·åœ¨åŒä¸€ä¸ª VSCode çª—å£ä¸­æ‰“å¼€å¤šä¸ªé¡¹ç›®æ–‡ä»¶å¤¹ã€‚å¦‚æœä½ çš„æ‰©å±•éœ€è¦æ”¯æŒå¤šå·¥ä½œåŒºï¼Œæˆ–è€…éœ€è¦æ ¹æ®ä¸åŒçš„å·¥ä½œåŒºæ–‡ä»¶å¤¹æ‰§è¡Œä¸åŒçš„æ“ä½œï¼ŒWorkspace API å°†éå¸¸æœ‰ç”¨ã€‚

-   **`vscode.workspace.workspaceFolders`**: è·å–å½“å‰å·¥ä½œåŒºçš„æ‰€æœ‰æ–‡ä»¶å¤¹ã€‚è¿”å›ä¸€ä¸ª `WorkspaceFolder[]` æ•°ç»„ï¼Œæ¯ä¸ª `WorkspaceFolder` å¯¹è±¡åŒ…å«æ–‡ä»¶å¤¹çš„ `uri` (URI å¯¹è±¡) å’Œ `name` (æ–‡ä»¶å¤¹åç§°)ã€‚
-   **`vscode.workspace.onDidChangeWorkspaceFolders`**: ç›‘å¬å·¥ä½œåŒºæ–‡ä»¶å¤¹å˜åŒ–äº‹ä»¶ã€‚å½“ç”¨æˆ·æ·»åŠ ã€ç§»é™¤æˆ–ç§»åŠ¨å·¥ä½œåŒºæ–‡ä»¶å¤¹æ—¶ï¼Œè¯¥äº‹ä»¶ä¼šè§¦å‘ã€‚
-   **`vscode.workspace.getWorkspaceFolder(uri)`**: æ ¹æ®ç»™å®šçš„ URIï¼Œè·å–è¯¥ URI æ‰€å±çš„å·¥ä½œåŒºæ–‡ä»¶å¤¹ã€‚
-   **`vscode.workspace.findFiles(globPattern, ignoreGlobPattern?, maxResults?, token?)`**: åœ¨å·¥ä½œåŒºä¸­æŸ¥æ‰¾æ–‡ä»¶ã€‚å¯ä»¥ä½¿ç”¨ Glob æ¨¡å¼åŒ¹é…æ–‡ä»¶è·¯å¾„ï¼Œæ”¯æŒæ’é™¤æ¨¡å¼ã€æœ€å¤§ç»“æœæ•°å’Œå–æ¶ˆä»¤ç‰Œã€‚
-   **`vscode.workspace.createFileSystemWatcher(globPattern, ignoreGlobPattern?, ignoreChangeEvents?, ignoreCreateEvents?, ignoreDeleteEvents?)`**: åˆ›å»ºæ–‡ä»¶ç³»ç»Ÿç›‘è§†å™¨ï¼Œç›‘å¬æ–‡ä»¶å˜åŒ–äº‹ä»¶ã€‚å¯ä»¥ç›‘å¬æ–‡ä»¶åˆ›å»ºã€ä¿®æ”¹ã€åˆ é™¤äº‹ä»¶ï¼Œå¹¶ä½¿ç”¨ Glob æ¨¡å¼è¿‡æ»¤æ–‡ä»¶ã€‚

**ç¤ºä¾‹:æ ¹æ®ä¸åŒçš„å·¥ä½œåŒºæ–‡ä»¶å¤¹æ˜¾ç¤ºä¸åŒçš„è§†å›¾**

```typescript
import * as vscode from 'vscode';

export function activate(context: vscode.ExtensionContext) {
    vscode.window.registerTreeDataProvider('myWorkspaceView', {
        getChildren: (element?: vscode.WorkspaceFolder) => {
            if (!vscode.workspace.workspaceFolders) {
                return Promise.resolve([]);
            }
            if (!element) {
                // æ ¹èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºå·¥ä½œåŒºæ–‡ä»¶å¤¹
                return Promise.resolve(vscode.workspace.workspaceFolders);
            } else {
                // å­èŠ‚ç‚¹ï¼Œæ˜¾ç¤ºæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ (è¿™é‡Œåªæ˜¯ç¤ºä¾‹ï¼Œå®é™…åº”ç”¨ä¸­å¯ä»¥æ ¹æ®éœ€è¦æ˜¾ç¤ºä¸åŒçš„å†…å®¹)
                return vscode.workspace.findFiles(`**/*`, undefined, undefined).then(files => {
                    return files.filter(file => vscode.workspace.getWorkspaceFolder(file) === element);
                });
            }
        },
        getTreeItem: (element: vscode.WorkspaceFolder | vscode.Uri) => {
            if (element instanceof vscode.WorkspaceFolder) {
                // å·¥ä½œåŒºæ–‡ä»¶å¤¹èŠ‚ç‚¹
                return new vscode.TreeItem(element.name, vscode.TreeItemCollapsibleState.Collapsed);
            } else {
                // æ–‡ä»¶èŠ‚ç‚¹
                return new vscode.TreeItem(vscode.workspace.asRelativePath(element));
            }
        }
    });
}
```

#### 2. Document API:æ·±å…¥æ–‡æœ¬ç¼–è¾‘

ğŸ“ **Document API** å…è®¸æ‰©å±•æ·±å…¥æ§åˆ¶æ–‡æœ¬ç¼–è¾‘å™¨ï¼ŒåŒ…æ‹¬è·å–å’Œä¿®æ”¹æ–‡æ¡£å†…å®¹ã€ç®¡ç†æ–‡æœ¬é€‰æ‹©ã€æ’å…¥å’Œåˆ é™¤æ–‡æœ¬ã€åº”ç”¨æ–‡æœ¬è£…é¥°å™¨ (Decorations) ç­‰ã€‚å¦‚æœä½ éœ€è¦å¼€å‘ä»£ç ç¼–è¾‘å™¨å¢å¼ºåŠŸèƒ½ã€ä»£ç æ ¼å¼åŒ–å·¥å…·ã€ä»£ç ç‰‡æ®µæ‰©å±•ç­‰ï¼ŒDocument API å°†æ˜¯ä½ çš„åˆ©å™¨ã€‚

-   **`vscode.window.activeTextEditor`**: è·å–å½“å‰æ¿€æ´»çš„æ–‡æœ¬ç¼–è¾‘å™¨ã€‚
-   **`vscode.window.visibleTextEditors`**: è·å–å½“å‰æ‰€æœ‰å¯è§çš„æ–‡æœ¬ç¼–è¾‘å™¨ã€‚
-   **`vscode.TextEditor.document`**: è·å–æ–‡æœ¬ç¼–è¾‘å™¨å…³è”çš„ `TextDocument` å¯¹è±¡ï¼Œè¡¨ç¤ºæ–‡æ¡£å†…å®¹ã€‚
-   **`vscode.TextDocument.getText(range?)`**: è·å–æ–‡æ¡£çš„æ–‡æœ¬å†…å®¹ï¼Œå¯ä»¥æŒ‡å®šèŒƒå›´ã€‚
-   **`vscode.TextDocument.lineCount`**: è·å–æ–‡æ¡£çš„è¡Œæ•°ã€‚
-   **`vscode.TextDocument.lineAt(lineNumber)`**: è·å–æŒ‡å®šè¡Œçš„ `TextLine` å¯¹è±¡ï¼ŒåŒ…å«è¡Œçš„æ–‡æœ¬å†…å®¹ã€è¡Œå·ã€Range ç­‰ä¿¡æ¯ã€‚
-   **`vscode.TextEditor.selection`**: è·å–å’Œè®¾ç½®æ–‡æœ¬ç¼–è¾‘å™¨çš„å½“å‰é€‰æ‹©åŒºåŸŸ (`Selection` å¯¹è±¡)ã€‚
-   **`vscode.TextEditor.selections`**: è·å–å’Œè®¾ç½®æ–‡æœ¬ç¼–è¾‘å™¨çš„å¤šå…‰æ ‡é€‰æ‹©åŒºåŸŸ (`Selection[]` æ•°ç»„)ã€‚
-   **`vscode.TextEditor.edit(editBuilder)`**: åº”ç”¨æ–‡æœ¬ç¼–è¾‘æ“ä½œã€‚ä½¿ç”¨ `TextEditorEdit` å¯¹è±¡æ„å»ºç¼–è¾‘æ“ä½œï¼Œä¾‹å¦‚æ’å…¥æ–‡æœ¬ã€æ›¿æ¢æ–‡æœ¬ã€åˆ é™¤æ–‡æœ¬ç­‰ã€‚
-   **`vscode.TextEditor.setDecorations(decorationType, rangesOrOptions)`**: åº”ç”¨æ–‡æœ¬è£…é¥°å™¨ã€‚å¯ä»¥ä½¿ç”¨ `DecorationOptions` æˆ– `Range` æ•°ç»„æŒ‡å®šè£…é¥°èŒƒå›´å’Œæ ·å¼ï¼Œä¾‹å¦‚é«˜äº®æ˜¾ç¤ºã€æ·»åŠ ä¸‹åˆ’çº¿ã€æ·»åŠ è¾¹æ¡†ç­‰ã€‚
-   **`vscode.TextEditor.revealRange(range, revealType?)`**: æ»šåŠ¨ç¼–è¾‘å™¨ï¼Œä½¿æŒ‡å®šçš„ Range å¯è§ã€‚

**ç¤ºä¾‹:å®ç°ä¸€ä¸ªç®€å•çš„ä»£ç é«˜äº®æ‰©å±•**

```typescript
import * as vscode from 'vscode';

export function activate(context: vscode.ExtensionContext) {
    let activeEditor = vscode.window.activeTextEditor;
    let decorationType = vscode.window.createTextEditorDecorationType({
        backgroundColor: 'rgba(255, 255, 0, 0.2)',
        border: '1px solid yellow'
    });

    function updateDecorations() {
        if (!activeEditor) {
            return;
        }
        const text = activeEditor.document.getText();
        const decorations: vscode.DecorationOptions[] = [];
        let match;
        const regEx = /vscode/gi; // åŒ¹é… "vscode" å…³é”®è¯ (å¿½ç•¥å¤§å°å†™)
        while ((match = regEx.exec(text))) {
            const startPos = activeEditor.document.positionAt(match.index);
            const endPos = activeEditor.document.positionAt(match.index + match[0].length);
            const decoration = { range: new vscode.Range(startPos, endPos), hoverMessage: 'å…³é”®è¯ **vscode**' };
            decorations.push(decoration);
        }
        activeEditor.setDecorations(decorationType, decorations);
    }

    function triggerUpdateDecorations(throttle = false) {
        if (throttle) {
            clearTimeout(timeout);
            timeout = setTimeout(updateDecorations, 500);
        } else {
            updateDecorations();
        }
    }

    let timeout: NodeJS.Timer | undefined;
    vscode.window.onDidChangeActiveTextEditor(editor => {
        activeEditor = editor;
        if (editor) {
            triggerUpdateDecorations();
        }
    }, null, context.subscriptions);

    vscode.workspace.onDidChangeTextDocument(event => {
        if (activeEditor && event.document === activeEditor.document) {
            triggerUpdateDecorations(true);
        }
    }, null, context.subscriptions);

    if (activeEditor) {
        triggerUpdateDecorations();
    }
}
```

#### 3. Language Server Protocol (LSP) å®¢æˆ·ç«¯ API

ğŸ—£ï¸ **Language Server Protocol (LSP)** æ˜¯ä¸€ç§æ ‡å‡†åŒ–çš„åè®®ï¼Œç”¨äºåœ¨ä»£ç ç¼–è¾‘å™¨å’Œè¯­è¨€æœåŠ¡å™¨ä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œå®ç°ä»£ç æ™ºèƒ½åŠŸèƒ½ï¼Œä¾‹å¦‚è‡ªåŠ¨è¡¥å…¨ã€ä»£ç å¯¼èˆªã€é”™è¯¯æ£€æŸ¥ã€ä»£ç æ ¼å¼åŒ–ç­‰ã€‚VSCode å†…ç½®äº† LSP å®¢æˆ·ç«¯ï¼Œå¹¶æä¾›äº† **LSP å®¢æˆ·ç«¯ API**ï¼Œå…è®¸æ‰©å±•ä¸è¯­è¨€æœåŠ¡å™¨è¿›è¡Œäº¤äº’ï¼Œæˆ–è€…å®ç°è‡ªå®šä¹‰çš„è¯­è¨€å®¢æˆ·ç«¯ã€‚å¦‚æœä½ éœ€è¦å¼€å‘è¯­è¨€æ”¯æŒæ‰©å±•ï¼Œæˆ–è€…éœ€è¦ä¸ç°æœ‰çš„è¯­è¨€æœåŠ¡å™¨é›†æˆï¼ŒLSP å®¢æˆ·ç«¯ API å°†éå¸¸æœ‰ç”¨ã€‚

-   **`vscode.languages.registerLanguageClient(clientOptions)`**: æ³¨å†Œè¯­è¨€å®¢æˆ·ç«¯ã€‚`clientOptions` æ˜¯ä¸€ä¸ª `LanguageClientOptions` å¯¹è±¡ï¼Œç”¨äºé…ç½®è¯­è¨€å®¢æˆ·ç«¯çš„å„ç§é€‰é¡¹ï¼Œä¾‹å¦‚è¯­è¨€ IDã€æœåŠ¡å™¨é€‰é¡¹ã€å®¢æˆ·ç«¯èƒ½åŠ›ç­‰ã€‚
-   **`vscode.languages.getLanguageClient(languageId)`**: æ ¹æ®è¯­è¨€ ID è·å–å·²æ³¨å†Œçš„è¯­è¨€å®¢æˆ·ç«¯ã€‚
-   **`vscode.LanguageClient`**: è¯­è¨€å®¢æˆ·ç«¯ç±»ï¼Œæä¾›äº†ä¸è¯­è¨€æœåŠ¡å™¨é€šä¿¡çš„æ–¹æ³•ï¼Œä¾‹å¦‚å‘é€è¯·æ±‚ã€å‘é€é€šçŸ¥ã€ç›‘å¬äº‹ä»¶ç­‰ã€‚

**ç¤ºä¾‹:æ³¨å†Œä¸€ä¸ªç®€å•çš„è¯­è¨€å®¢æˆ·ç«¯ (å‡è®¾å·²ç»æœ‰ä¸€ä¸ªè¿è¡Œä¸­çš„è¯­è¨€æœåŠ¡å™¨)**

```typescript
import * as vscode from 'vscode';
import { LanguageClient, LanguageClientOptions, ServerOptions, TransportKind } from 'vscode-languageclient/node';

let client: LanguageClient;

export function activate(context: vscode.ExtensionContext) {
    // è¯­è¨€æœåŠ¡å™¨æ¨¡å—çš„è·¯å¾„
    const serverModule = context.asAbsolutePath('server/server.js');
    // è°ƒè¯•æ¨¡å¼ä¸‹ï¼Œä½¿ç”¨ TCP ä¼ è¾“
    const debugOptions = { execArgv: ['--nolazy', '--inspect=6009'] };

    // æœåŠ¡å™¨é€‰é¡¹
    const serverOptions: ServerOptions = {
        run: { module: serverModule, transport: TransportKind.ipc },
        debug: { module: serverModule, transport: TransportKind.ipc, options: debugOptions }
    };

    // å®¢æˆ·ç«¯é€‰é¡¹
    const clientOptions: LanguageClientOptions = {
        documentSelector: [{ scheme: 'file', language: 'plaintext' }], // å…³è”çš„æ–‡æ¡£ç±»å‹
        synchronize: {
            configurationSection: 'plaintextLanguageServer', // åŒæ­¥é…ç½®
            fileEvents: vscode.workspace.createFileSystemWatcher('**/.clientrc') // ç›‘å¬æ–‡ä»¶å˜åŒ–
        }
    };

    // åˆ›å»ºè¯­è¨€å®¢æˆ·ç«¯
    client = new LanguageClient('plaintextLanguageServer', 'Plain Text Language Server', serverOptions, clientOptions);

    // å¯åŠ¨è¯­è¨€å®¢æˆ·ç«¯
    client.start();
}

export function deactivate(): Thenable<void> | undefined {
    if (!client) {
        return undefined;
    }
    return client.stop();
}
```

#### 4. Debug API:ç¨‹åºåŒ–æ§åˆ¶è°ƒè¯•å™¨

ğŸ **Debug API** å…è®¸æ‰©å±•ç¨‹åºåŒ–åœ°æ§åˆ¶ VSCode çš„è°ƒè¯•å™¨ï¼ŒåŒ…æ‹¬å¯åŠ¨è°ƒè¯•ä¼šè¯ã€è®¾ç½®æ–­ç‚¹ã€æ§åˆ¶è°ƒè¯•æ‰§è¡Œã€è·å–è°ƒè¯•çŠ¶æ€ç­‰ã€‚å¦‚æœä½ éœ€è¦å¼€å‘è‡ªå®šä¹‰çš„è°ƒè¯•å™¨æ‰©å±•ã€æˆ–è€…éœ€è¦åœ¨æ‰©å±•ä¸­é›†æˆè°ƒè¯•åŠŸèƒ½ï¼ŒDebug API å°†éå¸¸æœ‰ç”¨ã€‚

-   **`vscode.debug.startDebugging(folder, nameOrConfiguration, parentSession)`**: å¯åŠ¨è°ƒè¯•ä¼šè¯ã€‚å¯ä»¥æŒ‡å®šå·¥ä½œåŒºæ–‡ä»¶å¤¹ã€è°ƒè¯•é…ç½®åç§°æˆ–é…ç½®å¯¹è±¡ã€çˆ¶è°ƒè¯•ä¼šè¯ã€‚
-   **`vscode.debug.activeDebugSession`**: è·å–å½“å‰æ¿€æ´»çš„è°ƒè¯•ä¼šè¯ã€‚
-   **`vscode.debug.activeDebugSessions`**: è·å–å½“å‰æ‰€æœ‰æ¿€æ´»çš„è°ƒè¯•ä¼šè¯ã€‚
-   **`vscode.debug.onDidStartDebugSession`**: ç›‘å¬è°ƒè¯•ä¼šè¯å¯åŠ¨äº‹ä»¶.
-   **`vscode.debug.onDidTerminateDebugSession`**: ç›‘å¬è°ƒè¯•ä¼šè¯ç»“æŸäº‹ä»¶ã€‚
-   **`vscode.debug.onDidReceiveDebugSessionCustomEvent`**: ç›‘å¬è°ƒè¯•ä¼šè¯è‡ªå®šä¹‰äº‹ä»¶ã€‚
-   **`vscode.debug.breakpoints`**: è·å–å’Œè®¾ç½®å…¨å±€æ–­ç‚¹ (`Breakpoint[]` æ•°ç»„)ã€‚
-   **`vscode.debug.addBreakpoints(breakpoints)`**: æ·»åŠ æ–­ç‚¹ã€‚
-   **`vscode.debug.removeBreakpoints(breakpoints)`**: ç§»é™¤æ–­ç‚¹ã€‚

**ç¤ºä¾‹:æ‰©å±•ä¸­å¯åŠ¨è°ƒè¯•ä¼šè¯**

```typescript
import * as vscode from 'vscode';

export function activate(context: vscode.ExtensionContext) {
    let disposable = vscode.commands.registerCommand('extension.startDebugger', () => {
        vscode.debug.startDebugging(undefined, 'node-configuration'); // å¯åŠ¨åä¸º "node-configuration" çš„è°ƒè¯•é…ç½®
    });
    context.subscriptions.push(disposable);
}
```

#### 5. Task API:é›†æˆä»»åŠ¡ç³»ç»Ÿ

ğŸš€ **Task API** å…è®¸æ‰©å±•ä¸ VSCode çš„ä»»åŠ¡ç³»ç»Ÿé›†æˆï¼Œåˆ›å»ºå’Œç®¡ç†ä»»åŠ¡ï¼Œä¾‹å¦‚æ„å»ºä»»åŠ¡ã€æµ‹è¯•ä»»åŠ¡ã€éƒ¨ç½²ä»»åŠ¡ç­‰ã€‚VSCode çš„ä»»åŠ¡ç³»ç»Ÿå…è®¸ç”¨æˆ·åœ¨ VSCode ä¸­è¿è¡Œå¤–éƒ¨å‘½ä»¤å’Œè„šæœ¬ï¼Œå¹¶ä¸ç¼–è¾‘å™¨é›†æˆï¼Œä¾‹å¦‚åœ¨ "ç»ˆç«¯" é¢æ¿ä¸­æ˜¾ç¤ºä»»åŠ¡è¾“å‡ºã€åœ¨ "é—®é¢˜" é¢æ¿ä¸­æ˜¾ç¤ºä»»åŠ¡é”™è¯¯å’Œè­¦å‘Šç­‰ã€‚å¦‚æœä½ éœ€è¦æ‰©å±•æä¾›è‡ªå®šä¹‰çš„ä»»åŠ¡ï¼Œæˆ–è€…éœ€è¦ä¸ç°æœ‰çš„æ„å»ºå·¥å…·æˆ–ä»»åŠ¡è¿è¡Œå™¨é›†æˆï¼ŒTask API å°†éå¸¸æœ‰ç”¨ã€‚

-   **`vscode.tasks.registerTaskProvider(taskDefinition, provider)`**: æ³¨å†Œä»»åŠ¡æä¾›å™¨ã€‚ä»»åŠ¡æä¾›å™¨è´Ÿè´£æä¾›ä»»åŠ¡ã€‚
-   **`vscode.tasks.fetchTasks(filter?)`**: è·å–æ‰€æœ‰å¯ç”¨çš„ä»»åŠ¡ï¼Œå¯ä»¥æ ¹æ®ä»»åŠ¡ç±»å‹ã€ä»»åŠ¡å®šä¹‰ç­‰æ¡ä»¶è¿›è¡Œè¿‡æ»¤ã€‚
-   **`vscode.tasks.executeTask(task)`**: æ‰§è¡Œä»»åŠ¡ã€‚
-   **`vscode.tasks.onDidStartTask`**: ç›‘å¬ä»»åŠ¡å¯åŠ¨äº‹ä»¶ã€‚
-   **`vscode.tasks.onDidEndTask`**: ç›‘å¬ä»»åŠ¡ç»“æŸäº‹ä»¶ã€‚
-   **`vscode.tasks.onDidStartTaskProcess`**: ç›‘å¬ä»»åŠ¡è¿›ç¨‹å¯åŠ¨äº‹ä»¶ã€‚
-   **`vscode.tasks.onDidEndTaskProcess`**: ç›‘å¬ä»»åŠ¡è¿›ç¨‹ç»“æŸäº‹ä»¶ã€‚

**ç¤ºä¾‹:æ³¨å†Œä¸€ä¸ªç®€å•çš„ä»»åŠ¡æä¾›å™¨**

```typescript
import * as vscode from 'vscode';

export function activate(context: vscode.ExtensionContext) {
    vscode.tasks.registerTaskProvider('myTaskType', {
        provideTasks(token?: vscode.CancellationToken): vscode.ProviderResult<vscode.Task[]> {
            const taskDefinition: vscode.TaskDefinition = { type: 'myTaskType' };
            const task = new vscode.Task(taskDefinition, vscode.TaskScope.Workspace, 'My Task', 'my-extension');
            task.execution = new vscode.ShellExecution('echo Hello from My Task'); // ä»»åŠ¡æ‰§è¡Œçš„å‘½ä»¤
            task.problemMatchers = ["$jshint"]; // é—®é¢˜åŒ¹é…å™¨ (å¯é€‰)
            return [task];
        },
        resolveTask(task: vscode.Task, token?: vscode.CancellationToken): vscode.ProviderResult<vscode.Task> {
            return task;
        }
    });
}
```

#### 6. Terminal API:é›†æˆç»ˆç«¯

ğŸ’» **Terminal API** å…è®¸æ‰©å±•ä¸ VSCode çš„é›†æˆç»ˆç«¯è¿›è¡Œäº¤äº’ï¼ŒåŒ…æ‹¬åˆ›å»ºå’Œç®¡ç†ç»ˆç«¯ã€å‘é€å‘½ä»¤åˆ°ç»ˆç«¯ã€æ¥æ”¶ç»ˆç«¯è¾“å‡ºã€ç›‘å¬ç»ˆç«¯äº‹ä»¶ç­‰ã€‚å¦‚æœä½ éœ€è¦æ‰©å±•æä¾›ä¸ç»ˆç«¯äº¤äº’çš„åŠŸèƒ½ï¼Œä¾‹å¦‚è¿è¡Œå‘½ä»¤ã€ç›‘æ§è¿›ç¨‹ã€è‡ªåŠ¨åŒ–ç»ˆç«¯æ“ä½œç­‰ï¼ŒTerminal API å°†éå¸¸æœ‰ç”¨ã€‚

-   **`vscode.window.createTerminal(options?)`**: åˆ›å»ºç»ˆç«¯ã€‚å¯ä»¥æŒ‡å®šç»ˆç«¯åç§°ã€shell è·¯å¾„ã€ç¯å¢ƒå˜é‡ã€å·¥ä½œç›®å½•ç­‰é€‰é¡¹ã€‚
-   **`vscode.window.terminals`**: è·å–å½“å‰æ‰€æœ‰å·²åˆ›å»ºçš„ç»ˆç«¯ (`Terminal[]` æ•°ç»„)ã€‚
-   **`vscode.window.activeTerminal`**: è·å–å½“å‰æ¿€æ´»çš„ç»ˆç«¯ã€‚
-   **`vscode.window.onDidOpenTerminal`**: ç›‘å¬ç»ˆç«¯æ‰“å¼€äº‹ä»¶ã€‚
-   **`vscode.window.onDidCloseTerminal`**: ç›‘å¬ç»ˆç«¯å…³é—­äº‹ä»¶ã€‚
-   **`vscode.Terminal.show(preserveFocus?)`**: æ˜¾ç¤ºç»ˆç«¯ã€‚
-   **`vscode.Terminal.hide()`**: éšè—ç»ˆç«¯ã€‚
-   **`vscode.Terminal.sendText(text, addNewLine?)`**: å‘é€æ–‡æœ¬åˆ°ç»ˆç«¯ã€‚
-   **`vscode.Terminal.dispose()`**: é”€æ¯ç»ˆç«¯ã€‚

**ç¤ºä¾‹:æ‰©å±•ä¸­åˆ›å»ºå¹¶å‘é€å‘½ä»¤åˆ°ç»ˆç«¯**

```typescript
import * as vscode from 'vscode';

export function activate(context: vscode.ExtensionContext) {
    let disposable = vscode.commands.registerCommand('extension.runCommandInTerminal', () => {
        const terminal = vscode.window.createTerminal('My Terminal'); // åˆ›å»ºåä¸º "My Terminal" çš„ç»ˆç«¯
        terminal.show(); // æ˜¾ç¤ºç»ˆç«¯
        terminal.sendText('echo Hello from VSCode Extension'); // å‘é€å‘½ä»¤åˆ°ç»ˆç«¯
    });
    context.subscriptions.push(disposable);
}
```

#### 7. Webview API (é«˜çº§):æ›´å¼ºå¤§çš„ Webview åŠŸèƒ½

ğŸŒ **Webview API** é™¤äº†ä¹‹å‰ä»‹ç»çš„åŸºæœ¬åŠŸèƒ½å¤–ï¼Œè¿˜æä¾›äº†æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œä¾‹å¦‚:

-   **`WebviewPanel.reveal(viewColumn?, preserveFocus?)`**: æ˜¾ç¤º Webview é¢æ¿ï¼Œå¹¶å¯ä»¥æ§åˆ¶æ˜¯å¦ä¿ç•™ç„¦ç‚¹ã€‚
-   **`WebviewPanel.webview.asWebviewUri(localResource)`**: å°†æœ¬åœ°èµ„æº (ä¾‹å¦‚ HTML æ–‡ä»¶ã€CSS æ–‡ä»¶ã€JS æ–‡ä»¶ã€å›¾ç‰‡æ–‡ä»¶) è½¬æ¢ä¸º Webview å¯è®¿é—®çš„ URIã€‚**åœ¨ Webview ä¸­åŠ è½½æœ¬åœ°èµ„æºæ—¶ï¼Œå¿…é¡»ä½¿ç”¨ `asWebviewUri` è½¬æ¢ URIï¼Œä»¥ç¡®ä¿ Webview èƒ½å¤Ÿæ­£ç¡®åŠ è½½èµ„æºï¼Œå¹¶é˜²æ­¢å®‰å…¨é—®é¢˜ã€‚**
-   **`WebviewPanel.webview.cspSource`**: è·å– Webview çš„å†…å®¹å®‰å…¨ç­–ç•¥ (CSP) æºã€‚**åœ¨ Webview ä¸­ä½¿ç”¨å†…è” JavaScript æˆ– CSS æ—¶ï¼Œéœ€è¦é…ç½® CSPï¼Œä»¥ç¡®ä¿å®‰å…¨ã€‚**
-   **`WebviewPanel.onDidChangeViewState`**: ç›‘å¬ Webview é¢æ¿çš„è§†å›¾çŠ¶æ€å˜åŒ–äº‹ä»¶ï¼Œä¾‹å¦‚ Webview æ˜¯å¦å¯è§ã€æ˜¯å¦æ¿€æ´»ç­‰ã€‚
-   **`Webview.postMessage(message)`**: ä»æ‰©å±•ä»£ç å‘ Webview å‘é€æ¶ˆæ¯ã€‚
-   **`Webview.onDidReceiveMessage`**: ç›‘å¬ä» Webview å‘é€çš„æ¶ˆæ¯ã€‚

**ç¤ºä¾‹:åœ¨ Webview ä¸­åŠ è½½æœ¬åœ° HTML æ–‡ä»¶å¹¶ä½¿ç”¨ `asWebviewUri` è½¬æ¢ URI**

```typescript
import * as vscode from 'vscode';
import * as path from 'path';

export function activate(context: vscode.ExtensionContext) {
    let disposable = vscode.commands.registerCommand('extension.openWebview', () => {
        const panel = vscode.window.createWebviewPanel(
            'myWebview', // Webview ID
            'My Webview', // Webview æ ‡é¢˜
            vscode.ViewColumn.One, // åœ¨ç¼–è¾‘å™¨çš„å“ªä¸ªåˆ—ä¸­æ˜¾ç¤º Webview
            {
                enableScripts: true, // å¯ç”¨ JavaScript
                localResourceRoots: [context.extensionUri] // å…è®¸åŠ è½½æœ¬åœ°èµ„æºçš„æ ¹è·¯å¾„
            }
        );

        // åŠ è½½æœ¬åœ° HTML æ–‡ä»¶
        const htmlPath = path.join(context.extensionPath, 'webview', 'index.html');
        const htmlUri = vscode.Uri.file(htmlPath);
        const webviewUri = panel.webview.asWebviewUri(htmlUri); // è½¬æ¢ä¸º Webview URI

        panel.webview.html = `<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>My Webview</title>
        </head>
        <body>
            <h1>Hello from Webview!</h1>
            <img src="${webviewUri}" />  // ä½¿ç”¨è½¬æ¢åçš„ Webview URI
        </body>
        </html>`;
    });
    context.subscriptions.push(disposable);
}
```

### æ€»ç»“

ğŸ‰ æ­å–œä½ ï¼Œå®Œæˆäº† VSCode æ‰©å±•é«˜çº§ API æŠ€å·§çš„å­¦ä¹ ï¼æœ¬æ–‡ä»‹ç»äº† Workspace APIã€Document APIã€LSP å®¢æˆ·ç«¯ APIã€Debug APIã€Task APIã€Terminal API å’Œ Webview API ç­‰é«˜çº§ API æŠ€å·§ï¼Œå¹¶æä¾›äº†ä¸°å¯Œçš„ç¤ºä¾‹ä»£ç ã€‚æŒæ¡è¿™äº›é«˜çº§ API æŠ€å·§ï¼Œå°†ä½¿ä½ èƒ½å¤Ÿå¼€å‘å‡ºæ›´å¼ºå¤§ã€æ›´æ™ºèƒ½ã€æ›´ç”¨æˆ·å‹å¥½çš„ VSCode æ‰©å±•ï¼Œæ»¡è¶³æ›´å¤æ‚çš„éœ€æ±‚ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œä¸æ–­æ¢ç´¢å’Œå®è·µè¿™äº›é«˜çº§ APIï¼Œç»“åˆä½ çš„åˆ›æ„å’Œéœ€æ±‚ï¼Œç›¸ä¿¡ä½ ä¸€å®šèƒ½å¤Ÿåˆ›é€ å‡ºä»¤äººæƒŠè‰³çš„ VSCode æ‰©å±•ï¼Œä¸º VSCode ç¤¾åŒºè´¡çŒ®æ›´å¤šä¼˜ç§€çš„ä½œå“ï¼
