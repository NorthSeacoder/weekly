---
tags: [前端开发, V8, 编译执行, 解释执行]
category: V8
date: 2024-02-10
title: 我不知道的 V8:编译执行与解释执行的双重奏
desc: 深入探讨 V8 引擎如何巧妙结合编译执行与解释执行，实现高性能 JavaScript 运行。
slug: v8-js-engine-02
---

### 引言

🎼 在上一篇文章中，我们初步了解了 V8 引擎的基本概念和执行流程。今天，我们将深入 V8 引擎的核心，探讨其如何巧妙地结合**编译执行**和**解释执行**两种技术，从而实现 JavaScript 代码的高效运行。这两种执行方式就像一对默契的搭档，共同谱写了 V8 高性能的乐章。

### 编译执行 vs 解释执行

🤔 在深入 V8 之前，我们先来简单区分一下编译执行和解释执行这两种代码执行方式。

-   **编译执行（Compilation）**: 类似于"先翻译后阅读"。编译器（Compiler）会将源代码一次性翻译成**机器码**，然后计算机直接执行机器码。

    -   **优点**: 执行速度快，因为机器码是计算机可以直接理解和执行的语言。
    -   **缺点**: 编译过程耗时，跨平台性差，因为不同平台的机器码不同。

-   **解释执行（Interpretation）**: 类似于"同声传译"。解释器（Interpreter）会逐行读取源代码，边翻译边执行。
    -   **优点**: 启动速度快，跨平台性好，因为只需要在不同平台安装对应的解释器即可。
    -   **缺点**: 执行速度相对较慢，因为每次执行都需要进行解释。

### V8 的双重奏:Ignition 和 TurboFan

⚙️ V8 引擎并没有简单地选择其中一种执行方式，而是巧妙地将两者结合起来，发挥各自的优势。V8 使用了两个关键组件来实现这种"双重奏":**Ignition** 和 **TurboFan**。

1. **Ignition（解释器）**: V8 首先使用 **Ignition** 解释器来执行 JavaScript 代码。Ignition 的作用是将抽象语法树（AST）转换为**字节码（Bytecode）**，然后逐行解释执行字节码。

    - **作用**: 快速启动，降低内存占用。
    - **特点**: 解释执行字节码，执行速度相对较慢。

2. **TurboFan（优化编译器）**: 在 Ignition 解释执行字节码的过程中，V8 会监控代码的运行（Profiling），找出**热点代码（HotSpot）**，即频繁执行的代码片段。然后，**TurboFan** 优化编译器会将这些热点代码编译成**优化的机器码**，并替换掉原来的字节码。
    - **作用**: 提升热点代码的执行速度，充分发挥硬件性能。
    - **特点**: 即时编译（JIT），生成高度优化的机器码，执行速度极快。

### V8 如何实现高性能？

💡 V8 引擎通过 **Ignition** 和 **TurboFan** 的协同工作，实现了启动速度和执行速度的平衡。

-   **启动阶段**: 使用 Ignition 解释器快速启动程序，保证快速响应。
-   **运行阶段**: 使用 TurboFan 优化编译器，将热点代码编译成机器码，充分提升程序性能。

这种**解释执行 + 编译执行** 的混合模式，使得 V8 引擎既具备了解释执行的灵活性和跨平台性，又拥有了编译执行的高性能，从而在众多 JavaScript 引擎中脱颖而出。

### 总结

👏 V8 引擎的强大之处在于其巧妙地融合了编译执行和解释执行的优点。**Ignition 解释器**保证了快速启动和低内存占用，而 **TurboFan 优化编译器**则负责将热点代码编译成机器码，实现极致的性能优化。这种"双剑合璧"的设计，使得 V8 成为当今最先进的 JavaScript 引擎之一。理解 V8 的编译和解释执行机制，有助于我们更深入地理解 JavaScript 的运行原理，编写出更高性能的代码。
