# 📝 新增周刊内容工作流程指南

当数据完全迁移到 MySQL 后，有多种方式来新增周刊内容。以下是详细的工作流程说明：

## 🎯 方案概览

### 方案一：直接数据库操作（推荐）
使用专门的脚本直接向数据库添加内容，无需创建文件。

### 方案二：文件 + 同步
继续使用传统的文件系统方式创建内容，然后同步到数据库。

### 方案三：混合模式
根据需要灵活选择上述两种方式。

---

## 🚀 方案一：直接数据库操作

### 1. 交互式创建
```bash
npm run weekly:add
```

系统会引导你输入：
- 📝 标题
- 📂 分类 (工具/文章/教程/开源/资源等)
- 🏷️ 标签 (用逗号分隔)
- 🔗 来源 (可选)
- 📅 日期 (默认今天)
- 📝 内容 (输入 "END" 结束)

### 2. 从文件创建
```bash
npm run weekly:add-file -- path/to/your/file.mdx
```

支持从现有的 `.mdx` 或 `.md` 文件读取内容并添加到数据库。

### 特性
- ✅ 自动创建新分类和标签
- ✅ 智能关联到对应的周刊期号
- ✅ 自动计算阅读时间和字数
- ✅ 维护数据完整性

---

## 🔄 方案二：文件 + 同步

### 1. 创建文件
继续在 `sections/` 目录下创建 `.mdx` 文件：

```bash
# 使用现有的脚本
./bin/create-weekly.mjs
```

### 2. 同步到数据库
```bash
npm run sync:files
```

系统会：
- 🔍 扫描文件系统中的新文件
- 📊 对比数据库现有内容
- 🚀 自动运行增量迁移

---

## 📊 数据源管理

### 检查当前数据源状态
```bash
npm run dev:status
```

### 切换开发环境数据源
```bash
# 使用文件系统数据源
npm run dev:file

# 使用数据库数据源  
npm run dev:db
```

### 对比两个数据源
```bash
npm run dev:compare
```

---

## 🎨 推荐工作流程

### 对于日常周刊内容添加

1. **快速添加单个内容**
   ```bash
   npm run weekly:add
   ```

2. **批量处理现有文件**
   ```bash
   npm run weekly:add-file -- sections/2025-05/024.new-tool.mdx
   ```

### 对于大量内容迁移

1. **创建文件** (使用熟悉的方式)
   ```bash
   ./bin/create-weekly.mjs
   # 编辑文件...
   ```

2. **批量同步**
   ```bash
   npm run sync:files
   ```

---

## 🔧 高级功能

### 自动分类映射
系统会自动识别并创建新的分类：
- 工具、文章、教程、开源、资源
- 技巧、经验、框架、库、插件
- 设计、AI、学习、面试等

### 智能标签管理
- 自动创建新标签
- 维护标签使用计数
- 去重和规范化

### 周刊期号管理
- 自动关联到对应周期
- 智能创建新期号
- 维护期号内容统计

---

## 🛠️ 故障排除

### 数据不一致
```bash
npm run dev:compare
npm run db:check
```

### 重新同步
```bash
npm run migrate:clean
```

### 分析问题数据
```bash
npm run db:analyze-unnamed
```

---

## 📈 性能建议

1. **优先使用方案一** - 直接数据库操作更高效
2. **批量操作时使用方案二** - 文件批量创建 + 一次性同步
3. **定期检查数据一致性** - 使用 `npm run dev:compare`

---

## 🎯 最佳实践

### 内容创建
- 使用有意义的标题
- 选择合适的分类
- 添加相关标签
- 包含来源链接

### 数据维护
- 定期运行状态检查
- 保持文件系统和数据库同步
- 及时清理无效数据

### 开发环境
- 根据需要切换数据源
- 使用数据库数据源进行最终测试
- 保持两个数据源的一致性 