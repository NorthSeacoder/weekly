/**
 * 移动端体验增强样式
 * 针对触摸设备和小屏幕的优化
 */

/* ========================================
   1. 触摸目标优化
   ======================================== */

@media (max-width: 768px) {
  /* 确保所有可点击元素最小尺寸为 44x44px */
  button,
  a,
  [role="button"],
  [role="link"] {
    min-height: 44px;
    min-width: 44px;
  }

  /* 增加按钮内边距，提升触摸友好度 */
  .btn,
  button.btn {
    padding: 0.75rem 1.5rem;
  }

  /* 导航链接增加垂直间距 */
  nav a {
    padding-top: 0.75rem;
    padding-bottom: 0.75rem;
  }
}

/* ========================================
   2. 触摸反馈效果
   ======================================== */

@media (hover: none) and (pointer: coarse) {
  /* 移除 hover 效果，改用 active 状态 */
  button:active,
  a:active,
  [role="button"]:active {
    opacity: 0.7;
    transform: scale(0.98);
    transition: opacity 0.1s ease, transform 0.1s ease;
  }

  /* 移除不必要的 hover 动画 */
  *:hover {
    animation: none !important;
  }

  /* 优化触摸高亮 */
  * {
    -webkit-tap-highlight-color: rgba(var(--primary), 0.1);
    -webkit-touch-callout: none;
  }

  /* 链接和按钮保留触摸高亮 */
  a,
  button,
  [role="button"] {
    -webkit-tap-highlight-color: rgba(var(--primary), 0.15);
  }
}

/* ========================================
   3. 安全区域支持 (iOS Notch)
   ======================================== */

@supports (padding: env(safe-area-inset-top)) {
  /* Header 顶部安全区域 */
  header[data-header] {
    padding-top: env(safe-area-inset-top);
  }

  /* 底部安全区域 */
  footer,
  .fixed-bottom {
    padding-bottom: env(safe-area-inset-bottom);
  }

  /* 全屏弹窗的安全区域 */
  [data-search-modal],
  .modal {
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
  }

  /* 侧边栏安全区域 */
  .sidebar-left {
    padding-left: env(safe-area-inset-left);
  }

  .sidebar-right {
    padding-right: env(safe-area-inset-right);
  }
}

/* ========================================
   4. 滚动性能优化
   ======================================== */

@media (max-width: 768px) {
  /* 启用硬件加速滚动 */
  html {
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
  }

  /* 优化滚动容器 */
  .scroll-container,
  [data-scroll],
  .overflow-auto,
  .overflow-y-auto {
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-y: contain;
  }

  /* 减少重绘区域 */
  .card,
  .glass-effect,
  [data-card] {
    will-change: transform;
    transform: translateZ(0);
    backface-visibility: hidden;
  }

  /* 优化动画性能 */
  .animate-fade-in-up,
  .animate-float,
  .animate-bounce-in {
    will-change: opacity, transform;
  }
}

/* ========================================
   5. 字体和间距优化
   ======================================== */

@media (max-width: 640px) {
  /* 基础字体略微增大，提升可读性 */
  html {
    font-size: 16px;
  }

  /* 标题字号优化 */
  h1 {
    font-size: 2rem;
    line-height: 1.2;
  }

  h2 {
    font-size: 1.5rem;
    line-height: 1.3;
  }

  h3 {
    font-size: 1.25rem;
    line-height: 1.4;
  }

  /* 段落行高增加 */
  p {
    line-height: 1.7;
  }

  /* 卡片内边距调整 */
  .card,
  [data-card] {
    padding: 1rem;
  }

  /* 容器边距优化 */
  .container {
    padding-left: 1rem;
    padding-right: 1rem;
  }
}

/* ========================================
   6. 输入框和表单优化
   ======================================== */

@media (max-width: 768px) {
  /* 输入框字号防止自动缩放 */
  input,
  textarea,
  select {
    font-size: 16px !important;
  }

  /* 搜索框优化 */
  [type="search"],
  [data-search-input] {
    font-size: 16px;
    padding: 0.75rem 1rem;
  }

  /* 表单间距优化 */
  form > * + * {
    margin-top: 1rem;
  }
}

/* ========================================
   7. 导航和菜单优化
   ======================================== */

@media (max-width: 768px) {
  /* 移动端菜单动画优化 */
  [data-mobile-menu] {
    animation: slideDown 0.3s ease-out;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* 菜单项间距 */
  [data-mobile-menu] a,
  [data-mobile-menu] button {
    padding: 1rem;
    margin: 0.25rem 0;
  }

  /* 底部导航栏支持 */
  .bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    padding-bottom: env(safe-area-inset-bottom, 0);
    z-index: 40;
  }
}

/* ========================================
   8. 图片和媒体优化
   ======================================== */

@media (max-width: 768px) {
  /* 图片响应式 */
  img {
    max-width: 100%;
    height: auto;
  }

  /* 避免图片溢出 */
  .prose img,
  article img {
    margin-left: auto;
    margin-right: auto;
  }

  /* 视频响应式 */
  video,
  iframe {
    max-width: 100%;
    height: auto;
  }
}

/* ========================================
   9. 模态框和弹窗优化
   ======================================== */

@media (max-width: 768px) {
  /* 搜索弹窗全屏 */
  [data-search-modal] [data-search-container] {
    width: 100vw;
    max-width: 100vw;
    height: 100vh;
    max-height: 100vh;
    border-radius: 0;
    margin: 0;
  }

  /* 弹窗内容区域优化 */
  [data-search-results] {
    max-height: calc(100vh - 200px);
  }

  /* 模态框按钮全宽 */
  .modal button,
  [role="dialog"] button {
    width: 100%;
  }
}

/* ========================================
   10. 可访问性增强
   ======================================== */

@media (max-width: 768px) {
  /* 焦点样式增强 */
  *:focus-visible {
    outline: 3px solid hsl(var(--primary));
    outline-offset: 3px;
  }

  /* 跳过链接（用于键盘导航） */
  .skip-to-content {
    position: absolute;
    left: -9999px;
    top: 0;
    z-index: 999;
    padding: 1rem;
    background: hsl(var(--background));
    color: hsl(var(--foreground));
  }

  .skip-to-content:focus {
    left: 1rem;
    top: 1rem;
  }
}

/* ========================================
   11. 性能优化 - 减少动画
   ======================================== */

@media (max-width: 768px) {
  /* 简化复杂动画 */
  .animate-shimmer,
  .animate-glow {
    animation: none;
  }

  /* 减少阴影复杂度 */
  .shadow-2xl,
  .shadow-3xl {
    box-shadow: var(--shadow-lg);
  }

  /* 简化渐变 */
  .bg-gradient-to-br,
  .bg-gradient-to-tr {
    background: hsl(var(--background));
  }
}

/* ========================================
   12. 横屏模式优化
   ======================================== */

@media (max-width: 768px) and (orientation: landscape) {
  /* 减少垂直空间占用 */
  header[data-header] {
    height: 3.5rem;
  }

  .hero,
  [data-hero] {
    min-height: 60vh;
  }

  /* 优化按钮布局 */
  .btn-group {
    flex-direction: row;
    justify-content: center;
  }
}

/* ========================================
   13. 小屏设备特别优化 (320px - 375px)
   ======================================== */

@media (max-width: 375px) {
  /* 进一步缩小字号 */
  html {
    font-size: 14px;
  }

  /* 按钮字号调整 */
  .btn,
  button {
    font-size: 0.875rem;
    padding: 0.625rem 1.25rem;
  }

  /* 卡片间距减小 */
  .card,
  [data-card] {
    padding: 0.75rem;
  }

  /* 网格间距调整 */
  .grid {
    gap: 0.75rem;
  }
}

/* ========================================
   14. PWA 相关优化
   ======================================== */

@media (display-mode: standalone) {
  /* PWA 模式下的状态栏高度补偿 */
  body {
    padding-top: env(safe-area-inset-top);
  }

  /* 隐藏浏览器相关提示 */
  .browser-notice {
    display: none;
  }
}

/* ========================================
   15. 黑暗模式移动端优化
   ======================================== */

@media (max-width: 768px) {
  .dark {
    /* 降低黑暗模式对比度，减少眼睛疲劳 */
    --background: 220 15% 10%;
    --foreground: 214 35% 95%;
  }

  /* 优化黑暗模式下的阴影 */
  .dark .shadow-lg,
  .dark .shadow-xl {
    box-shadow: none;
    border: 1px solid hsl(var(--border));
  }
}
