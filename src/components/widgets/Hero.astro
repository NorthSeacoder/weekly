---
import Image from '~/components/common/Image.astro';
import Button from '~/components/ui/Button.astro';
import { cn } from '~/utils/utils';

import type { Hero as Props } from '~/types';

const {
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline,

  content = await Astro.slots.render('content'),
  actions = await Astro.slots.render('actions'),
  image = await Astro.slots.render('image'),

  id,
  bg = await Astro.slots.render('bg'),
} = Astro.props;
---

<section class="relative md:-mt-[76px] not-prose overflow-hidden min-h-screen flex items-center" {...id ? { id } : {}}>
  <!-- 高级背景装饰 - 亮色暗色主题适配 -->
  <div class="absolute inset-0 pointer-events-none" aria-hidden="true">
    <!-- 主渐变背景 - 更柔和的渐变，亮色主题优化 -->
    <div class="absolute inset-0 bg-gradient-to-br from-primary/8 via-accent-warm/5 to-accent-cool/8 dark:from-primary/5 dark:via-accent-warm/3 dark:to-accent-cool/5 opacity-60 dark:opacity-80"></div>
    
    <!-- 动态光晕装饰元素 - 亮色主题优化 -->
    <div class="absolute top-20 left-10 w-64 h-64 bg-gradient-to-br from-primary/15 to-accent-warm/15 dark:from-primary/10 dark:to-accent-warm/10 rounded-full blur-3xl opacity-50 dark:opacity-70 animate-pulse" style="animation-duration: 8s;"></div>
    <div class="absolute bottom-20 right-10 w-48 h-48 bg-gradient-to-br from-accent-cool/15 to-primary/15 dark:from-accent-cool/10 dark:to-primary/10 rounded-full blur-3xl opacity-50 dark:opacity-70 animate-pulse" style="animation-duration: 12s; animation-delay: 2s;"></div>
    
    <!-- 微妙的网格背景 - 亮色主题优化 -->
    <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zNiAxOGMxLjIgMCAyLjEuOSAyLjEgMi4xdjE5LjhjMCAxLjItLjkgMi4xLTIuMSAyLjFIMTguMWMtMS4yIDAtMi4xLS45LTIuMS0yLjFWMjAuMWMwLTEuMi45LTIuMSAyLjEtMi4xaDE3Ljh6TTYwIDBIMHY2MGg2MFYweiIgZmlsbD0iIzAwMDAwMCIgZmlsbC1vcGFjaXR5PSIuMDMiLz48cGF0aCBkPSJNMzAgMEgwdjYwaDMwVjB6IiBmaWxsPSIjMDAwMDAwIiBmaWxsLW9wYWNpdHk9Ii4wMiIvPjwvZz48L3N2Zz4=')] dark:bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHZpZXdCb3g9IjAgMCA2MCA2MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPjxwYXRoIGQ9Ik0zNiAxOGMxLjIgMCAyLjEuOSAyLjEgMi4xdjE5LjhjMCAxLjItLjkgMi4xLTIuMSAyLjFIMTguMWMtMS4yIDAtMi4xLS45LTIuMS0yLjFWMjAuMWMwLTEuMi45LTIuMSAyLjEtMi4xaDE3Ljh6TTYwIDBIMHY2MGg2MFYweiIgZmlsbD0iI2ZmZmZmZiIgZmlsbC1vcGFjaXR5PSIuMDIiLz48cGF0aCBkPSJNMzAgMEgwdjYwaDMwVjB6IiBmaWxsPSIjZmZmZmZmIiBmaWxsLW9wYWNpdHk9Ii4wMSIvPjwvZz48L3N2Zz4=')]"></div>
    
    <!-- 微妙的光束效果 - 亮色主题优化 -->
    <div class="absolute -top-40 -left-20 w-96 h-96 bg-gradient-radial-primary-soft opacity-15 dark:opacity-20 rotate-12"></div>
    <div class="absolute -bottom-40 -right-20 w-96 h-96 bg-gradient-radial-warm-soft opacity-15 dark:opacity-20 -rotate-12"></div>
    
    <!-- 动态装饰元素 - 亮色主题优化 -->
    <div class="absolute top-1/4 right-1/4 w-32 h-32 border border-primary/15 dark:border-primary/10 rounded-full opacity-30 dark:opacity-40"></div>
    <div class="absolute bottom-1/4 left-1/4 w-24 h-24 border border-accent-warm/15 dark:border-accent-warm/10 rounded-full opacity-30 dark:opacity-40"></div>
    
    <slot name="bg">
      {bg ? <Fragment set:html={bg} /> : null}
    </slot>
  </div>

  <!-- 主要内容 -->
  <div class="relative max-w-7xl mx-auto px-4 sm:px-6 w-full">
    <div class="pt-0 md:pt-[76px] pointer-events-none"></div>
    <div class="py-8 md:py-12 lg:py-16">
      <div class="text-center pb-6 md:pb-8 max-w-5xl mx-auto">
        
        <!-- 标语 - 更现代的设计 -->
        {tagline && (
          <div class="mb-8 animate-fade-in-down">
            <span class="inline-flex items-center px-6 py-3 rounded-full text-sm font-medium bg-gradient-to-r from-primary/15 via-accent-warm/12 to-accent-cool/15 text-gray-700 dark:text-gray-200 border border-white/20 dark:border-gray-800/40 backdrop-blur-xl shadow-lg hover:shadow-xl transition-all duration-500 hover:scale-105 group cursor-default relative overflow-hidden">
              <!-- 微妙的光效 -->
              <span class="absolute inset-0 bg-gradient-to-r from-primary/10 to-accent-warm/10 opacity-0 group-hover:opacity-100 transition-opacity duration-700"></span>
              
              <svg class="w-5 h-5 mr-3 text-primary dark:text-primary-light transition-transform duration-300 group-hover:rotate-12 relative z-10" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
              </svg>
              <span class="relative z-10"><Fragment set:html={tagline} /></span>
            </span>
          </div>
        )}
        
        <!-- 主标题 - 更具视觉冲击力 -->
        {title && (
          <h1 class="text-4xl md:text-5xl lg:text-6xl xl:text-7xl font-black leading-[0.9] tracking-tight mb-8 font-heading animate-fade-in-up" style="animation-delay: 0.2s;">
            <span class="bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 dark:from-white dark:via-gray-200 dark:to-white bg-clip-text text-transparent drop-shadow-sm relative">
              <!-- 微妙的装饰线 -->
              <span class="absolute -bottom-2 left-1/2 transform -translate-x-1/2 w-24 h-1 bg-gradient-to-r from-primary/40 to-accent-warm/40 rounded-full blur-sm"></span>
              <Fragment set:html={title} />
            </span>
          </h1>
        )}
        
        <!-- 副标题 - 更优雅的排版 -->
        <div class="max-w-4xl mx-auto animate-fade-in-up" style="animation-delay: 0.4s;">
          {subtitle && (
            <p class="text-base md:text-lg lg:text-xl text-gray-600 dark:text-gray-300 mb-10 leading-relaxed font-light tracking-wide">
              <Fragment set:html={subtitle} />
            </p>
          )}
          
          <!-- 行动按钮 - 更现代的设计 -->
          {actions && (
            <div class="flex flex-col sm:flex-row gap-6 justify-center items-center mb-10">
              {Array.isArray(actions) ? (
                actions.map((action, index) => (
                  <div class="animate-fade-in-up" style={`animation-delay: ${0.6 + index * 0.1}s;`}>
                    <Button 
                      variant={action?.variant || 'primary'}
                      size="lg"
                      href={action?.href?.toString() || undefined}
                      target={action?.target || undefined}
                      rel={action?.rel || undefined}
                      class={cn(
                        "px-6 py-3 text-base font-medium rounded-lg transition-colors duration-200",
                        action?.variant === 'primary' 
                          ? "bg-blue-600 hover:bg-blue-700 text-white" 
                          : "bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 text-gray-900 dark:text-white",
                        action?.class
                      )}
                    >
                      <span class="relative z-10">{action?.text || action?.title}</span>
                    </Button>
                  </div>
                ))
              ) : (
                <Fragment set:html={actions} />
              )}
            </div>
          )}
        </div>
        
        {content && (
          <div class="animate-fade-in-up" style="animation-delay: 0.8s;">
            <Fragment set:html={content} />
          </div>
        )}
      </div>
      
      <!-- 图片/内容展示 - 更具高级感 -->
      <div class="animate-fade-in-up" style="animation-delay: 1s;">
        {image && (
          <div class="relative m-auto max-w-7xl">
            <!-- 高级图片装饰背景 -->
            <div class="absolute inset-0 bg-gradient-to-r from-primary/20 via-accent-warm/20 to-accent-cool/20 rounded-3xl blur-3xl transform scale-110 opacity-30"></div>
            <div class="absolute inset-0 bg-gradient-to-br from-primary/10 via-transparent to-accent-warm/10 rounded-3xl blur-2xl transform scale-105 opacity-40"></div>
            
            <!-- 微妙的光束效果 -->
            <div class="absolute -top-20 -left-20 w-64 h-64 bg-gradient-radial-primary-soft opacity-30 rotate-12"></div>
            <div class="absolute -bottom-20 -right-20 w-64 h-64 bg-gradient-radial-warm-soft opacity-30 -rotate-12"></div>
            
            <!-- 图片容器 -->
            <div class="relative">
              {typeof image === 'string' ? (
                <Fragment set:html={image} />
              ) : (
                <Image
                  class="mx-auto rounded-3xl shadow-xl shadow-gray-500/20 dark:shadow-gray-900/40 border border-gray-200/30 dark:border-gray-700/30 w-full hover:shadow-2xl transition-all duration-700 hover:scale-[1.02] hover:-translate-y-4 relative"
                  widths={[400, 768, 1024, 2040]}
                  sizes="(max-width: 767px) 400px, (max-width: 1023px) 768px, (max-width: 2039px) 1024px, 2040px"
                  loading="eager"
                  width={1024}
                  height={576}
                  {...image}
                />
              )}
              
              <!-- 微妙的装饰元素 -->
              <div class="absolute -bottom-4 -right-4 w-24 h-24 border border-primary/20 rounded-full opacity-60"></div>
              <div class="absolute -top-4 -left-4 w-16 h-16 border border-accent-warm/20 rounded-full opacity-60"></div>
            </div>
          </div>
        )}
      </div>
    </div>
  </div>
  
  <!-- 底部装饰渐变 - 更精致的边界 -->
  <div class="absolute bottom-0 left-0 right-0 h-px bg-gradient-to-r from-transparent via-gray-300 dark:via-gray-700 to-transparent opacity-60"></div>
  
  <!-- 底部装饰图案 - 更柔和的过渡 -->
  <div class="absolute bottom-0 left-0 right-0 h-40 bg-gradient-to-t from-background/95 to-transparent pointer-events-none"></div>
</section>

<style>
  /* 增强动画效果 - 更流畅的过渡 */
  @keyframes fade-in-down {
    0% {
      opacity: 0;
      transform: translateY(-30px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes fade-in-up {
    0% {
      opacity: 0;
      transform: translateY(30px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .animate-fade-in-down {
    animation: fade-in-down 1.2s cubic-bezier(0.22, 1, 0.36, 1) both;
  }
  
  .animate-fade-in-up {
    animation: fade-in-up 1.2s cubic-bezier(0.22, 1, 0.36, 1) both;
  }

  /* 优化文字渲染 - 更精细的字体处理 */
  h1 {
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1;
    letter-spacing: -0.03em;
    line-height: 1.05;
  }

  /* 响应式字体优化 - 更精确的尺寸控制 */
  @media (max-width: 640px) {
    h1 {
      font-size: 2.5rem;
      line-height: 1.1;
      letter-spacing: -0.02em;
      margin-bottom: 1.75rem;
    }
    
    p {
      font-size: 1rem;
      line-height: 1.6;
      margin-bottom: 2.25rem;
    }
  }

  @media (min-width: 641px) and (max-width: 768px) {
    h1 {
      font-size: 3rem;
      line-height: 1.05;
      letter-spacing: -0.025em;
      margin-bottom: 2rem;
    }
    
    p {
      font-size: 1.125rem;
      line-height: 1.6;
      margin-bottom: 2.75rem;
    }
  }
  
  @media (min-width: 769px) and (max-width: 1024px) {
    h1 {
      font-size: 3.5rem;
      line-height: 1;
      letter-spacing: -0.03em;
    }
  }
  
  @media (min-width: 1025px) {
    h1 {
      font-size: 4.5rem;
      line-height: 0.95;
      letter-spacing: -0.035em;
    }
  }

  /* 提升可读性 - 更精细的文本处理 */
  p {
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    letter-spacing: 0.01em;
    line-height: 1.7;
  }

  /* 减少动画对于喜欢减少动画的用户 */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  /* 高对比度模式 - 更好的可访问性 */
  @media (prefers-contrast: high) {
    .bg-gradient-to-r {
      background: hsl(var(--primary)) !important;
    }
    
    .text-transparent {
      color: hsl(var(--foreground)) !important;
      background: none !important;
      -webkit-background-clip: unset !important;
      background-clip: unset !important;
    }
    
    .border {
      border-width: 2px !important;
    }
  }

  /* 暗色模式特殊处理 - 更精细的暗色模式适配 */
  .dark .shadow-xl {
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.4);
  }
  
  .dark .bg-gradient-to-r {
    --tw-gradient-stops: var(--tw-gradient-from) 0%, var(--tw-gradient-to) 100%;
  }

  /* 大屏幕优化 - 更好的大屏适配 */
  @media (min-width: 1920px) {
    .max-w-7xl {
      max-width: 90rem;
    }
    
    h1 {
      font-size: 5.5rem;
    }
    
    p {
      font-size: 1.5rem;
    }
  }

  /* 超大屏幕优化 - 更精确的超大屏适配 */
  @media (min-width: 2560px) {
    h1 {
      font-size: 7rem;
      letter-spacing: -0.04em;
    }
    
    p {
      font-size: 1.75rem;
      line-height: 1.6;
    }
    
    .max-w-7xl {
      max-width: 100rem;
    }
  }
</style>