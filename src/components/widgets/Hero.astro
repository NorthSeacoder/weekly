---
import Image from '~/components/common/Image.astro';
import Button from '~/components/ui/Button.astro';
import { cn } from '~/utils/utils';

import type { Hero as Props } from '~/types';

const {
  title = await Astro.slots.render('title'),
  subtitle = await Astro.slots.render('subtitle'),
  tagline,

  content = await Astro.slots.render('content'),
  actions = await Astro.slots.render('actions'),
  image = await Astro.slots.render('image'),

  id,
  bg = await Astro.slots.render('bg'),
} = Astro.props;
---

<section class="relative md:-mt-[76px] not-prose overflow-hidden min-h-screen flex items-center" {...id ? { id } : {}}>
  <!-- 动态星空背景 -->
  <div class="absolute inset-0 pointer-events-none overflow-hidden" aria-hidden="true">
    <!-- 基础背景 -->
    <div class="absolute inset-0 bg-page"></div>
    
    <!-- 动态光晕 -->
    <!-- 动态光晕 -->
    <div class="absolute top-[-10%] left-[-10%] w-[40%] h-[40%] bg-primary/5 blur-[120px] rounded-full opacity-20 animate-blob-slow mix-blend-screen"></div>
    <div class="absolute top-[20%] right-[-10%] w-[30%] h-[30%] bg-purple-900/20 blur-[100px] rounded-full opacity-20 animate-blob-slow animation-delay-4000 mix-blend-screen"></div>
    <div class="absolute bottom-[-10%] left-[20%] w-[35%] h-[35%] bg-blue-900/20 blur-[120px] rounded-full opacity-20 animate-blob-slow animation-delay-8000 mix-blend-screen"></div>

    <!-- 星星/粒子效果 -->
    <div class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20 brightness-100 contrast-150 mix-blend-overlay"></div>
    
    <slot name="bg">
      {bg ? <Fragment set:html={bg} /> : null}
    </slot>
  </div>

  <!-- 主要内容 -->
  <div class="relative max-w-7xl mx-auto px-6 sm:px-8 w-full">
    <div class="pt-0 md:pt-[76px] pointer-events-none"></div>
    <div class="py-12 md:py-16 lg:py-20">
      <div class="text-center pb-12 md:pb-16 max-w-5xl mx-auto">
        
        <!-- 标语 -->
        {tagline && (
          <div class="mb-8 animate-fade-in-down flex justify-center">
            <div class="inline-flex items-center px-4 py-1.5 rounded-full border border-white/10 bg-white/5 backdrop-blur-sm shadow-sm">
              <span class="text-sm font-medium text-muted-foreground tracking-wide">
                <Fragment set:html={tagline} />
              </span>
            </div>
          </div>
        )}
        
        <!-- 主标题 -->
        {title && (
          <h1 class="text-4xl md:text-5xl lg:text-6xl font-bold leading-[1.1] tracking-tight mb-8 font-heading animate-text-reveal text-transparent bg-clip-text bg-gradient-to-b from-white via-white/90 to-white/70">
            <Fragment set:html={title} />
          </h1>
        )}
        
        <!-- 副标题 -->
        <div class="max-w-4xl mx-auto animate-fade-in-up" style="animation-delay: 0.6s;">
          {subtitle && (
            <div class="mb-10 leading-relaxed text-muted-foreground text-lg md:text-xl font-normal max-w-3xl mx-auto animate-slide-up-fade">
              <Fragment set:html={subtitle} />
            </div>
          )}
          
          <!-- 行动按钮 -->
          {actions && (
            <div class="flex flex-wrap sm:flex-row gap-4 justify-center items-center mb-16">
              {Array.isArray(actions) ? (
                actions.map((action, index) => (
                  <div class="animate-fade-in-up" style={`animation-delay: ${0.6 + index * 0.1}s;`}>
                    <Button 
                      variant={action?.variant || 'primary'}
                      size="lg"
                      href={action?.href?.toString() || undefined}
                      target={action?.target || undefined}
                      rel={action?.rel || undefined}
                      class={cn(
                        "px-8 py-3.5 text-base font-medium rounded-full transition-all duration-300 shadow-lg hover:shadow-xl hover:-translate-y-0.5",
                        action?.class
                      )}
                    >
                      {action?.text || action?.title}
                    </Button>
                  </div>
                ))
              ) : (
                <Fragment set:html={actions} />
              )}
            </div>
          )}
        </div>
        
        {content && (
          <div class="animate-fade-in-up" style="animation-delay: 0.8s;">
            <Fragment set:html={content} />
          </div>
        )}
      </div>
      
      <!-- 图片/内容展示 -->
      <div class="animate-fade-in-up" style="animation-delay: 1s;">
        {image && (
          <div class="relative m-auto max-w-6xl">
            <!-- 图片容器 -->
            <div class="relative group">
              <div class="absolute -inset-1 bg-gradient-to-r from-primary/20 to-accent-warm/20 rounded-[2rem] blur opacity-25 group-hover:opacity-50 transition duration-1000 group-hover:duration-200"></div>
              <div class="relative">
                {typeof image === 'string' ? (
                  <Fragment set:html={image} />
                ) : (
                  <Image
                    class="mx-auto rounded-[1.8rem] shadow-2xl shadow-black/50 border border-white/10 w-full bg-card"
                    widths={[400, 768, 1024, 2040]}
                    sizes="(max-width: 767px) 400px, (max-width: 1023px) 768px, (max-width: 2039px) 1024px, 2040px"
                    loading="eager"
                    width={1024}
                    height={576}
                    {...image}
                  />
                )}
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  </div>
  
</section>

<style>
  /* 动画定义 */
  @keyframes fade-in-down {
    0% {
      opacity: 0;
      transform: translateY(-20px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  @keyframes fade-in-up {
    0% {
      opacity: 0;
      transform: translateY(20px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .animate-fade-in-down {
    animation: fade-in-down 0.8s ease-out both;
  }
  
  .animate-fade-in-up {
    animation: fade-in-up 0.8s ease-out both;
  }

  /* 优化文字渲染 */
  h1 {
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    font-feature-settings: "kern" 1, "liga" 1, "calt" 1;
  }

  /* 响应式优化 */
  @media (max-width: 640px) {
    h1 {
      font-size: 2.25rem;
      line-height: 1.1;
      margin-bottom: 2rem;
    }
    
    p {
      font-size: 1.125rem;
      margin-bottom: 2.5rem;
    }
  }

  /* 减少动画 */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  /* 高对比度模式 */
  @media (prefers-contrast: high) {
    .bg-gradient-to-r {
      background: hsl(var(--primary)) !important;
    }
    
    .text-transparent {
      color: hsl(var(--foreground)) !important;
      background: none !important;
      -webkit-background-clip: unset !important;
      background-clip: unset !important;
    }
  }

  /* 动画性能优化 */
  .animate-fade-in-down,
  .animate-fade-in-up {
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000px;
  }

  /* 触摸设备优化 */
  @media (hover: none) {
    .hover\:scale-105:hover,
    .hover\:scale-\[1\.02\]:hover,
    .hover\:-translate-y-1:hover,
    .hover\:-translate-y-2:hover {
      transform: none;
    }
  }

  /* 新增动画定义 */
  @keyframes blob {
    0% { transform: translate(0px, 0px) scale(1); }
    33% { transform: translate(30px, -50px) scale(1.1); }
    66% { transform: translate(-20px, 20px) scale(0.9); }
    100% { transform: translate(0px, 0px) scale(1); }
  }
  
  .animate-blob {
    animation: blob 7s infinite;
  }

  .animate-blob-slow {
    animation: blob 20s infinite;
  }
  
  .animation-delay-2000 {
    animation-delay: 2s;
  }
  
  .animation-delay-4000 {
    animation-delay: 4s;
  }

  @keyframes text-reveal {
    0% {
      opacity: 0;
      transform: translateY(20px);
      filter: blur(10px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
      filter: blur(0);
    }
  }
  
  .animate-text-reveal {
    animation: text-reveal 1s cubic-bezier(0.2, 0.65, 0.3, 0.9) both;
    animation-delay: 0.2s;
  }
  
  @keyframes slide-up-fade {
    0% {
      opacity: 0;
      transform: translateY(10px);
    }
    100% {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  .animate-slide-up-fade {
    animation: slide-up-fade 0.8s ease-out both;
    animation-delay: 0.4s;
  }
</style>