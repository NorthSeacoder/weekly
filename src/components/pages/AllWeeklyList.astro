---
import { getWeeklyPosts } from '~/utils/contents/unified-content'
import StatCard from '~/components/ui/StatCard.astro'
import { cn } from '~/utils/utils'

const weeklyList = await getWeeklyPosts()
---

<section class="py-16 lg:py-20 bg-page min-h-screen relative overflow-hidden">
    <!-- 背景装饰元素 -->
    <div class="absolute inset-0 pointer-events-none">
        <!-- 极简网格背景 -->
        <div class="absolute inset-0 bg-[linear-gradient(rgba(255,255,255,0.02)_1px,transparent_1px),linear-gradient(90deg,rgba(255,255,255,0.02)_1px,transparent_1px)] bg-[size:60px_60px] opacity-20"></div>
        
        <!-- 顶部微光 -->
        <div class="absolute top-0 left-1/2 -translate-x-1/2 w-full h-[500px] bg-primary/5 blur-[120px] rounded-full opacity-30"></div>
    </div>

    <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <!-- 页面标题区域 -->
        <div class="text-center mb-16 lg:mb-20">
            <!-- 标签 -->
            <div class="inline-flex items-center px-4 py-1.5 rounded-full border border-white/10 bg-white/5 backdrop-blur-sm shadow-sm mb-8">
                <span class="text-sm font-medium text-muted-foreground tracking-wide">全部内容</span>
            </div>
            
            <!-- 主标题 -->
            <h1 class="text-5xl lg:text-6xl xl:text-7xl font-bold leading-[1.1] tracking-tight mb-8 font-heading text-foreground">
                周刊归档
            </h1>
            
            <!-- 副标题 -->
            <p class="text-xl lg:text-2xl text-muted-foreground max-w-4xl mx-auto leading-relaxed font-light mb-10">
                探索我们精心整理的技术周刊合集，每一期都是前端技术世界的精华摘要
            </p>
            
            <!-- 统计信息 -->
            <div class="flex flex-col sm:flex-row items-center justify-center gap-6 sm:gap-12 text-muted-foreground">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-secondary rounded-xl flex items-center justify-center border border-border">
                        <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
                        </svg>
                    </div>
                    <span class="text-lg font-medium">共 <strong class="text-foreground">{weeklyList.length}</strong> 期周刊</span>
                </div>
                <div class="w-px h-8 bg-border hidden sm:block"></div>
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-secondary rounded-xl flex items-center justify-center border border-border">
                        <svg class="w-5 h-5 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <span class="text-lg font-medium">持续更新中</span>
                </div>
            </div>
        </div>

        <!-- 周刊网格 -->
        <div class={cn(
            "grid gap-6 md:gap-8",
            "grid-cols-1 sm:grid-cols-2 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",
            "2xl:grid-cols-4 auto-cols-fr",
            "max-w-8xl mx-auto mb-16 weekly-grid"
        )}>
            {weeklyList.map((weekly, index) => (
                <div 
                    class="animate-fade-in-up group" 
                    style={`animation-delay: ${Math.min(index * 0.05, 1)}s;`}
                    data-weekly-card
                >
                    <a href={weekly.permalink} class="block h-full focus:outline-none focus:ring-2 focus:ring-primary/50 focus:ring-offset-0 rounded-[2px]">
                        <StatCard
                            title={weekly.title}
                            date={weekly.date}
                            tags={weekly.tags}
                        />
                    </a>
                </div>
            ))}
        </div>

        <!-- 底部装饰区域 -->
        <!-- 底部装饰区域 -->
        <div class="text-center">
            <!-- 装饰性分隔线 -->
            <div class="flex items-center justify-center mb-12">
                <div class="h-px bg-gradient-to-r from-transparent via-border to-transparent flex-1 max-w-[200px]"></div>
                <div class="mx-6 flex items-center gap-2 text-muted-foreground text-sm font-medium">
                    <span class="tracking-wide">持续更新中</span>
                </div>
                <div class="h-px bg-gradient-to-l from-transparent via-border to-transparent flex-1 max-w-[200px]"></div>
            </div>
            
            <!-- 回到顶部按钮 -->
            <button 
                onclick="window.scrollTo({top: 0, behavior: 'smooth'})"
                class="inline-flex items-center gap-2 px-6 py-3 bg-secondary text-foreground rounded-full border border-border hover:border-primary/50 transition-all duration-300 hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-primary/50 focus:ring-offset-2 group"
                aria-label="回到顶部"
            >
                <svg class="w-4 h-4 transition-transform duration-300 group-hover:-translate-y-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                </svg>
                <span class="font-medium tracking-wide text-sm">回到顶部</span>
            </button>
        </div>
    </div>
</section>

<style>
    /* 动画定义 */
    @keyframes fade-in-up {
        0% {
            opacity: 0;
            transform: translateY(40px) scale(0.95);
        }
        100% {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }
    
    .animate-fade-in-up {
        animation: fade-in-up 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) both;
    }

    /* 网格布局优化 */
    .grid {
        display: grid;
        align-items: stretch;
    }

    /* 确保卡片高度一致 */
    .grid > div {
        height: 100%;
        display: flex;
        flex-direction: column;
    }

    .grid > div > a {
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    /* 智能响应式网格 */
    .weekly-grid {
        /* 使用 CSS Grid 的 auto-fit 和 minmax 来实现智能响应式 */
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }
    
    /* 针对不同屏幕尺寸的优化 */
    @media (max-width: 480px) {
        .weekly-grid {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        
        h1 {
            font-size: 2.5rem;
            line-height: 1.1;
        }
        
        .text-xl {
            font-size: 1.125rem;
        }
    }

    @media (min-width: 481px) and (max-width: 640px) {
        .weekly-grid {
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1.5rem;
        }
    }

    @media (min-width: 641px) and (max-width: 768px) {
        .weekly-grid {
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }
    }

    @media (min-width: 769px) and (max-width: 1024px) {
        .weekly-grid {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
    }

    @media (min-width: 1025px) and (max-width: 1280px) {
        .weekly-grid {
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2rem;
            max-width: 1200px;
        }
    }

    @media (min-width: 1281px) and (max-width: 1536px) {
        .weekly-grid {
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            gap: 2.5rem;
            max-width: 1400px;
        }
    }

    @media (min-width: 1537px) {
        .weekly-grid {
            grid-template-columns: repeat(4, 1fr);
            gap: 2.5rem;
            max-width: 1600px;
        }
    }

    /* 减少动画 */
    @media (prefers-reduced-motion: reduce) {
        .animate-fade-in-up {
            animation: none;
            opacity: 1;
            transform: none;
        }
        
        .animate-pulse {
            animation: none;
        }
    }

    /* 性能优化 */
    .grid > div {
        transform: translateZ(0);
        backface-visibility: hidden;
    }
    
    /* 高对比度模式 */
    @media (prefers-contrast: high) {
        .bg-gradient-to-r,
        .bg-gradient-to-br,
        .bg-gradient-to-l {
            background: hsl(var(--background)) !important;
        }
        
        .text-transparent {
            color: hsl(var(--foreground)) !important;
            background: none !important;
            -webkit-background-clip: unset !important;
            background-clip: unset !important;
        }
    }

    /* 触摸设备优化 */
    @media (hover: none) {
        .hover\:scale-105:hover,
        .hover\:-translate-y-1:hover {
            transform: none;
        }
    }
    
    /* 文字渲染优化 */
    h1 {
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        font-feature-settings: "kern" 1, "liga" 1, "calt" 1;
    }
    
    /* 卡片悬停效果增强 */
    [data-weekly-card]:hover {
        z-index: 10;
    }
    
    /* 焦点状态增强 */
    a:focus-visible {
        outline: 2px solid hsl(var(--primary));
        outline-offset: 4px;
        border-radius: 1rem;
    }
    
    /* 加载状态 */
    .grid[data-loading="true"] > div {
        opacity: 0.5;
        pointer-events: none;
    }
    
    .grid[data-loading="true"] > div::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        animation: shimmer 1.5s linear infinite;
        border-radius: inherit;
    }
    
    @keyframes shimmer {
        0% { transform: translateX(-100%); }
        100% { transform: translateX(100%); }
    }
    
    /* 暗色模式特殊处理 */
    .dark .grid > div {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }
    
    /* 打印样式 */
    @media print {
        .animate-fade-in-up {
            animation: none;
            opacity: 1;
            transform: none;
        }
        
        button {
            display: none;
        }
    }
</style>